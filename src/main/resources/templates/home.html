<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <div class="card mt-4">
        <div class="card-header text-center">
            <h3>Home</h3>
        </div>
        <div class="card-body text-center">
            <!--카카오 oauth 로그인 버튼-->
            <div class="d-flex justify-content-center mb-3">
                <a href="/oauth2/authorization/kakao">
                    <img src="/img/kakaoLogin.png" alt="카카오 로그인" width="183">
                </a>
            </div>
            <!--구글 oauth 로그인 버튼-->
            <div class="d-flex justify-content-center mb-3">
                <a href="/oauth2/authorization/google">
                    <img src="/img/googleLogin.png" alt="구글 로그인" width="183">
                </a>
            </div>
            <a class="btn btn-secondary" id="logout-btn">로그아웃</a>
            <a class="btn btn-primary" href="/profile">프로필</a>
        </div>
        <div class="card-body text=center d-flex justify-content-center">
            <a id="user-name">로그인을 해주세요</a>
        </div>
        </div>
    </div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const token = searchParam('token');

        if (token) {
            console.log("✅ 액세스 토큰 저장:", token);
            localStorage.setItem("access_token", token);

            // 토큰이 URL에 남아 있지 않도록 현재 URL 정리
            const newUrl = removeParam("token");
            history.replaceState({}, document.title, newUrl);
        }

        function searchParam(key) {
            return new URLSearchParams(location.search).get(key);
        }

        function removeParam(param) {
            const url = new URL(window.location.href);
            url.searchParams.delete(param);
            return url.toString();
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const token = localStorage.getItem("access_token");  // 로컬 스토리지에서 토큰 가져오기

        fetch("/api/profile", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            }
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("유저 정보를 불러올 수 없습니다.");
                }
                return response.json();
            })
            .then(user => {
                // 로컬 스토리지에서 가져온 사용자 정보로 각 요소를 업데이트
                document.getElementById("user-name").textContent = user.username;
            });
    });
</script>
<script>
    // 로그아웃 버튼 클릭 시
    document.getElementById("logout-btn").addEventListener("click", function() {
        // localStorage에서 액세스 토큰 삭제
        localStorage.removeItem("access_token");

        // 만약 로그아웃 후 다른 페이지로 이동하고 싶다면
        window.location.href = "/"; // 로그인 페이지로 리다이렉트
    });

</script>
</html>